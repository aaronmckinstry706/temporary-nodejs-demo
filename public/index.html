<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WebSocket Demo</title>
  <style>
    #status.connected { color: green; }
    #status.disconnected { color: red; }
  </style>
</head>
<body>
  <button id="connect">Connect</button>
  <button id="disconnect" disabled>Disconnect</button>
  <span id="status" class="disconnected">Disconnected</span>

  <h3>Connected clients:</h3>
  <ul id="clients"></ul>

  <script>
    let socket;
    let intervalId;
    const connectBtn = document.getElementById('connect');
    const disconnectBtn = document.getElementById('disconnect');
    const statusSpan = document.getElementById('status');
    const clientsList = document.getElementById('clients');

    function updateStatus(connected) {
      statusSpan.textContent = connected ? 'Connected' : 'Disconnected';
      statusSpan.className = connected ? 'connected' : 'disconnected';
      connectBtn.disabled = connected;
      disconnectBtn.disabled = !connected;
    }

    connectBtn.addEventListener('click', () => {
      socket = new WebSocket(`ws://${location.host}`);
      socket.addEventListener('open', () => {
        updateStatus(true);
        intervalId = setInterval(() => {
          socket.send(JSON.stringify({ type: 'list' }));
        }, 2000);
      });
      socket.addEventListener('message', (event) => {
        const data = JSON.parse(event.data);
        if (data.type === 'list') {
          clientsList.innerHTML = '';
          data.clients.forEach(id => {
            const li = document.createElement('li');
            li.textContent = id;
            clientsList.appendChild(li);
          });
        }
      });
      socket.addEventListener('close', () => {
        updateStatus(false);
        clientsList.innerHTML = '';
        clearInterval(intervalId);
      });
    });

    disconnectBtn.addEventListener('click', () => {
      if (socket) {
        socket.close();
      }
    });

    updateStatus(false);
  </script>
</body>
</html>
